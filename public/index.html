<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Udacity Todos Goals</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <script type="text/javascript">
      /* Library Code */

      function createStore(reducer) {
        // The store should have four parts:
        // 1. The state.
        // 2. Get the state.
        // 3. Listen to changes on the state.
        // 4. Update the state.

        // 1 State
        let state;
        let listeners = [];

        // 2 Get
        const getState = () => state;

        // 3 Listen
        const subscribe = (listener) => {
          // Push the function that is being passed to 'subscribe' when it is invoked
          listeners.push(listener);
          // Unsubscribe: filter out the original listener function that was passed in when 'subscribe' was invoked
          return () => {
            listeners = listeners.filter((l) => l !== listener);
          };
        };

        // 4 Update
        const dispatch = (action) => {
          // Get the new state
          state = reducer(state, action);
          // Invoke all listeners set up by the user
          listeners.forEach((listener) => listener());
        };

        return { getState, subscribe, dispatch };
      }

      /* App Code */

      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // Reducer Function 1
      // Cases to update the internal state of our store
      function todos(state = [], action) {
        // Listen to a specific event type
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter((todo) => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map((todo) =>
              todo.id !== action.id ? todo : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      // Reducer Function 2
      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter((goal) => goal.id !== action.id);
          default:
            return state;
        }
      }

      // Root Reducer
      function app(state = {}, action) {
        return {
          // All reducers will be invoked: todos() and goals()
          todos: todos(state.todos, action),
          goals: goals(state.goals, action),
        };
      }

      // Action Creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo,
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id,
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id,
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal,
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id,
        };
      }

      // Create instance of our store, passing a single reducer
      const store = createStore(app);

      // Listener for whenever the state changes
      store.subscribe(() => console.log('The new state is: ', store.getState()));

      // Update state with an action object, using action creator functions
      store.dispatch(
        addTodoAction({
          id: 0,
          name: 'Walk the dog',
          complete: false,
        })
      );

      store.dispatch(
        addTodoAction({
          id: 1,
          name: 'Wash the car',
          complete: false,
        })
      );

      store.dispatch(
        addTodoAction({
          id: 2,
          name: 'Go to the gym',
          complete: true,
        })
      );

      store.dispatch(removeTodoAction(1));

      store.dispatch(toggleTodoAction(0));

      store.dispatch(
        addGoalAction({
          id: 0,
          name: 'Learn Redux',
        })
      );

      store.dispatch(
        addGoalAction({
          id: 1,
          name: 'Lose 20 pounds',
        })
      );

      store.dispatch(removeGoalAction(0));
    </script>
  </body>
</html>
