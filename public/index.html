<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Udacity Todos Goals</title>

    <!-- Redux Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>

    <!-- React, React-DOM and Babel libraries -->
    <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div>
      <h1>Todo List</h1>
      <input id="todo" type="text" placeholder="Add Todo" />
      <button id="todoBtn">Add Todo</button>
      <ul id="todos"></ul>
    </div>

    <div>
      <h1>Goals</h1>
      <input id="goal" type="text" placeholder="Add Goal" />
      <button id="goalBtn">Add Goal</button>
      <ul id="goals"></ul>
    </div>

    <noscript>You need to enable JavaScript to run this app.</noscript>

    <hr />

    <div id="app"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <script type="text/javascript">
      // Helper Function to generate ID
      function generateId() {
        return Math.random().toString(36).substring(2) + new Date().getTime().toString(36);
      }

      /* App Code */

      const ADD_TODO = 'ADD_TODO';
      const REMOVE_TODO = 'REMOVE_TODO';
      const TOGGLE_TODO = 'TOGGLE_TODO';
      const ADD_GOAL = 'ADD_GOAL';
      const REMOVE_GOAL = 'REMOVE_GOAL';

      // Reducer Function 1
      // Cases to update the internal state of our store
      function todos(state = [], action) {
        // Listen to a specific event type
        switch (action.type) {
          case ADD_TODO:
            return state.concat([action.todo]);
          case REMOVE_TODO:
            return state.filter((todo) => todo.id !== action.id);
          case TOGGLE_TODO:
            return state.map((todo) =>
              todo.id !== action.id ? todo : Object.assign({}, todo, { complete: !todo.complete })
            );
          default:
            return state;
        }
      }

      // Reducer Function 2
      function goals(state = [], action) {
        switch (action.type) {
          case ADD_GOAL:
            return state.concat([action.goal]);
          case REMOVE_GOAL:
            return state.filter((goal) => goal.id !== action.id);
          default:
            return state;
        }
      }

      // Action Creators
      function addTodoAction(todo) {
        return {
          type: ADD_TODO,
          todo,
        };
      }

      function removeTodoAction(id) {
        return {
          type: REMOVE_TODO,
          id,
        };
      }

      function toggleTodoAction(id) {
        return {
          type: TOGGLE_TODO,
          id,
        };
      }

      function addGoalAction(goal) {
        return {
          type: ADD_GOAL,
          goal,
        };
      }

      function removeGoalAction(id) {
        return {
          type: REMOVE_GOAL,
          id,
        };
      }

      // DOM code

      // Functions to hook buttons
      function addTodo() {
        const input = document.getElementById('todo');
        const name = input.value;
        input.value = '';

        store.dispatch(
          addTodoAction({
            id: generateId(),
            name,
            complete: false,
          })
        );
      }

      function addGoal() {
        const input = document.getElementById('goal');
        const name = input.value;
        input.value = '';

        store.dispatch(
          addGoalAction({
            id: generateId(),
            name,
          })
        );
      }

      document.getElementById('todoBtn').addEventListener('click', addTodo);

      document.getElementById('goalBtn').addEventListener('click', addGoal);

      // Helper function to create a remove button
      function createRemoveBtn(onClick) {
        const removeBtn = document.createElement('button');
        removeBtn.innerHTML = 'X';
        removeBtn.addEventListener('click', onClick);
        return removeBtn;
      }

      // Functions to populate the DOM
      function addTodoToDOM(todo) {
        const node = document.createElement('li');
        const text = document.createTextNode(todo.name);
        const removeBtn = createRemoveBtn(() => {
          store.dispatch(removeTodoAction(todo.id));
        });

        node.appendChild(text);
        node.appendChild(removeBtn);

        // Toggle strikethrough for complete item
        node.style.textDecoration = todo.complete ? 'line-through' : 'none';
        node.addEventListener('click', () => {
          store.dispatch(toggleTodoAction(todo.id));
        });
        document.getElementById('todos').appendChild(node);
      }

      function addGoalToDOM(goal) {
        const node = document.createElement('li');
        const text = document.createTextNode(goal.name);
        const removeBtn = createRemoveBtn(() => {
          store.dispatch(removeGoalAction(goal.id));
        });

        node.appendChild(text);
        node.appendChild(removeBtn);

        document.getElementById('goals').appendChild(node);
      }

      // Middleware
      const checker = (store) => (next) => (action) => {
        if (action.type === ADD_TODO && action.todo.name.toLowerCase().includes('bitcoin')) {
          return alert("Nope. That's a bad idea!");
        }

        if (action.type === ADD_GOAL && action.goal.name.toLowerCase().includes('bitcoin')) {
          return alert("Nope. That's a bad idea!");
        }

        return next(action);
      };

      const logger = (store) => (next) => (action) => {
        console.group(action.type);
        console.log('The action: ', action);
        const result = next(action);
        console.log('The new state: ', store.getState());
        console.groupEnd();

        return result;
      };

      // Create instance of our store, passing a single reducer
      const store = Redux.createStore(
        Redux.combineReducers({
          todos,
          goals,
        }),
        Redux.applyMiddleware(checker, logger)
      );

      // Listener for whenever the state changes
      store.subscribe(() => {
        const { todos, goals } = store.getState();

        document.getElementById('todos').innerHTML = '';
        document.getElementById('goals').innerHTML = '';

        todos.forEach(addTodoToDOM);
        goals.forEach(addGoalToDOM);

        // console.log('The new state is: ', store.getState())
      });
    </script>

    <script type="text/babel">
      function List(props) {
        return (
          <ul>
            <li>List</li>
          </ul>
        );
      }

      class Todos extends React.Component {
        render() {
          return (
            <div>
              TODOS
              <List />
            </div>
          );
        }
      }

      class Goals extends React.Component {
        render() {
          return (
            <div>
              GOALS
              <List />
            </div>
          );
        }
      }

      class App extends React.Component {
        render() {
          return (
            <div>
              <Todos />
              <Goals />
            </div>
          );
        }
      }

      ReactDOM.render(<App />, document.getElementById('app'));
    </script>
  </body>
</html>
